# Эшелоны
## Описание задачи 
**Цели и задачи модели**: автоматизация расчета эшелона ликвидности долговых ценных бумаг без использования TRPS, ранее выдаваемого Bloomberg. На основании имеющихся у Банка данных рассчитать необходимые показатели для определения к какому эшелону относится бумага. Необходимо обучить модель и сделать предикт.
Было принято решение включить следующие признаки: 
- Index: уникальный код бумаги
- Desciption: описание бумаги
- Duration: дюрация
- Amount: общая основная стоимость облигации, которую ещё не погасил эмитент
- TRPS: коэффициент, который давался Bloomberg'ом 
- Rating: кредитный рейтинг эмитента
- Date: дата отчета, из которого брались данные
- Listing: уровень листинга (оценка биржей надёжности бумаг)
- Lombard: принадлежность к ломбардному списку ЦБ
- Liquidity: коэффициент ликвидности бумаги
- Currency: валюта, в которой обращается бумага
  Index, Desciption, Duration, Amount, TRPS, Rating, Date, Currency берутся из Excel файлов в папке "Эшелоны".
  Listing, Lombard, Liquidity: информацию по этим признакам необходимо достать из других источников.
  ### Листинг
  В подготовке обучающей выборки Listing берется из БД с данными по всем бумагам. Далее с 2022 г. загрузка данных в БД прекратилась и для тестовых данных уровень листинга берется через API биржи MOEX.
  ### Ломбардный список
  На сайте ЦБ РФ есть xml файлы по датам со списками бумаг. В перечень попадают ценные бумаги, соответствующие довольно жестким требованиям регулятора. Необходимо загрузить файлы, пропарсить их и занести 0 (если не входит) и 1 (если входит) в датасет. По результатам обучения был сделан вывод, что Lombard незначимая переменная и далее в модели она не участвует.
  ### Коэффициент ликвидности
  Данный коэффициент рассчитывается по формуле с сайта «dohod.ru» :
  ![image](https://github.com/user-attachments/assets/c6e41282-470d-49bf-9102-6bfb0aa09346)

  Для обучающей выборки вычисление переменных из формулы происходило из данных в БД Sql запросами. Для тестовой выборки получение данных для вычисления переменных происходит опять же через API запросы к MOEX.
  ## Стек технологий
  - Язык: Python
  - Библиотеки:
    - pandas — для работы с таблицами данных
    - sklearn — для создания моделей машинного обучения
    - SQLAlchemy, pyodbc — для взаимодействия с базами данных
    - SMOTE — для работы с несбалансированными данными
    - matplotlib — для визуализации данных
  ## Функциональность
  - Автоматическое объединение Excel файлов в единый датасет.
  - Очистка и предварительная обработка данных.
  - Построение моделей машинного обучения (например, DecisionTreeClassifier).
  - Визуализация результатов.
  ## Структура проекта
  - Скрипты обработки данных: объединение файлов, обработка несбалансированных данных.
  - Модели машинного обучения: обучение и тестирование классификаторов на собранных данных.
  - Визуализация данных: построение графиков для анализа результатов.
